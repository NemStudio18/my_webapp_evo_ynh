# Framework mode - Override main nginx.conf behavior

# Exception pour ads.txt : sert le fichier directement
location = __PATH__/ads.txt {
    alias __INSTALL_DIR__/www/public/ads.txt;
    add_header Content-Type text/plain;
    access_log off;
    log_not_found off;
}

# Redirection globale type framework - ÉCRASE le comportement principal
# La racine web est /www/public, index.php est dans public/
location __PATH__/ {
    root __INSTALL_DIR__/www/public;
    try_files $uri /index.php$is_args$args;
    autoindex off;
}

# Interdire certains fichiers sensibles
location ~* \.(json|tpl|ini|env)$ {
    deny all;
}

# Interdire l'accès aux fichiers et dossiers cachés, sauf .well-known
location ~ ^__PATH__/(.+/|)\.(?!well-known/) {
    deny all;
}

# Interprétation des fichiers PHP
location ~ \.php$ {
    include snippets/fastcgi-php.conf;
    fastcgi_pass unix:/var/run/php/php__PHP_VERSION__-fpm-__APP__.sock;
    fastcgi_param SCRIPT_FILENAME $request_filename;
}

