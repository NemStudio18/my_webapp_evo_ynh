#sub_path_only rewrite ^__PATH__$ __PATH__/ permanent;
location __PATH__/ {

    # Path to source
    alias __INSTALL_DIR__/www/;

    # Default indexes and catch-all
    index index.php index.html;
    
    # Mode-specific routing logic
    # Static mode: serve files directly, 404 if not found
    # Front-controller/Framework: redirect to index.php if file not found
    # Note: This will be overridden by mode-specific rewrite files
    try_files $uri $uri/ /index.php$is_args$args;

    # Prevent useless logs
    location = __PATH__/favicon.ico {
        log_not_found off;
        access_log off;
    }

    location = __PATH__/robots.txt {
        allow all;
        log_not_found off;
        access_log off;
    }

    # Deny access to hidden files and directories
    location ~ ^__PATH__/(.+/|)\.(?!well-known\/) {
        deny all;
    }

    # Include mode-specific rewrite rules FIRST
    # This allows rewrite files to override the main behavior
    include conf.d/__DOMAIN__.d/__APP__.d/rewrite-*.conf;

    include conf.d/__DOMAIN__.d/__APP__.d/*.conf;

    # Include SSOWAT user panel.
    include conf.d/yunohost_panel.conf.inc;
}
